# Odometry with Tree Extraction
<!-- TODO:
        correct the flow of the sentences -->
Odometry can be used to measure the movement of the robot calculated by the change in position of different and/or multiple sensors. One way to perform odometry is with the use of a camera and a Lidar. The frames generated by the camera can be used to extract certain points out of the frames as reference points in order to localize the robot relative to these points. Similarly, the Lidar is mainly used to create a map of the environment. But from the environment, certain points can be extracted with the same purpose as the camera. Using the same extraction methods on different input sources, forces us to use the same, or similar enough, datatypes. Hence why pointclouds are used to perform extraction. From the Lidar a pointcloud is the raw output. For the camera, a simple conversion is needed to convert the frames, in depth, infrared or color, to a pointcloud.

To summarise, odometry will be implemented with both the camera and lidar by finding features in pointclouds.

There are multiple features that can be focussed on, for example, certain poles positioned at checkpoints, an empty section indicating the end of the row. But one solution, that is complex but the objects are always present, is extracting trees. More importantly, the tree stems. A Tree Extraction algorithm, called [TreeSeg](https://github.com/apburt/treeseg), is a tree identification and segmentation algorithm that extracts tree stumps, stems and the crown by finding cylinder like forms in the pointclouds.

## What is tree extraction?

As mentioned earlier, tree extraction is a method to fully extract a tree, its stump, the stem and the crown from a frame. The frame can be gathered from either the Lidar or the camera, but it needs to be converted to a point-cloud first.
## Pre-requirements to run TreeSeg

The installation of TreeSeg can be found on the github: https://github.com/apburt/treeseg.
TreeSeg requires the installation the Point Cloud Library (PCL). This should be installed as wel. During the installation, some problems might occur, such as library linking, external needed libraries and file includes from the PCL. Solutions to these problems are not simple enough to explain. Linking problems general occurs when symlinks to the library aren't setup, the same goes for includes.  

## Structure

In this directory multiple sub-directories are created to divide the camera, lidar and png files.

The ply files are extracted from the Neuvision viewer and then converted to pcd files with a python script. Which you can run with Python3 nameofpythonfile nameofplyfile. The conversion is available the other way around as wel. The python file is located in src/python. The pcd file stands for Point Cloud Data, pcd is what the Point Cloud Library requires as input, logically, TreeSeg does too.

The file names are ordered with a number, so that we know which the ply, pcd, png belong to each other.

## Steps

The documentation of Tree Segmentation can be found here: https://github.com/apburt/treeseg.
While the steps of performing TreeSeg on the pcd files can be found here: https://github.com/apburt/treeseg/blob/master/doc/tutorial_overview.md.

Tip: After every step, convert the pcd file back to ply because ply files can be visualised with Meshlab. This can be handy for visualising the in between results of TreeSeg to see possibble faults.